{"version":3,"file":"vue.js","sources":["../../src/reactivity/computed.js","../../src/shared/index.js","../../src/reactivity/effect.js","../../src/reactivity/baseHandlers.js","../../src/reactivity/reactive.js","../../src/reactivity/ref.js"],"sourcesContent":["export function computed(){\r\n    \r\n}","export const isObject = (val) =>typeof val==='object'&&val!==null\r\nexport const isSymbol = (val) =>typeof val==='symbol'\r\n\r\nexport const isArray = Array.isArray\r\n\r\nexport const isInteger = (key)=>''+parseInt(key,10)===key\r\n\r\nconst hasOwnProperty = Object.prototype.hasOwnProperty\r\n\r\nexport const hasOwn = (val,key)=>hasOwnProperty.call(val,key)\r\n\r\nexport const hasChanged = (value,oldValue)=>value!==oldValue\r\n\r\n","import {isArray} from \"../shared/index\";\r\n\r\nexport function effect(fn,options = {}){ // effect =>vue2 watch\r\n    const effect = createReactiveEffect(fn,options)\r\n\r\n    if(!options.lazy){\r\n        effect()\r\n    }\r\n}\r\nlet uid = 0;\r\nlet activeEffect; // 用来存储当前的effect函数\r\nconst effectStack = []\r\nfunction createReactiveEffect(fn,options){\r\n    let effect = function (){\r\n        if(!effectStack.includes(effect)){ // 防止递归执行\r\n            try{\r\n                activeEffect = effect\r\n                effectStack.push(activeEffect)\r\n                return fn() // 用户自己写的逻辑,内部会对数据进行取值操作\r\n            }finally {\r\n                effectStack.pop()\r\n                activeEffect = effectStack[effectStack.length-1]\r\n            }\r\n        }\r\n    }\r\n    effect.id = uid++\r\n    effect.deps = [] // 用来表示effect中依赖了哪些属性\r\n    return effect;\r\n}\r\n// {object:{key:[effect,effect]}}\r\nconst targetMap = new WeakMap()\r\n// 将属性和effect做一个关联\r\nexport function track(target,key){\r\n    if(activeEffect===undefined){\r\n        return false\r\n    }\r\n    let depsMap = targetMap.get(target)\r\n    if(!depsMap){\r\n        targetMap.set(target,(depsMap=new Map()))\r\n    }\r\n    let dep = depsMap.get(key)\r\n    if(!dep){\r\n        depsMap.set(key,(dep=new Set))\r\n    }\r\n    if(!dep.has(activeEffect)){ // 如果没有effect 就把effect放进集合中\r\n        dep.add(activeEffect)\r\n        activeEffect.deps.push(key) // 双向记忆的过程\r\n    }\r\n\r\n    // console.log('targetMap',targetMap)\r\n\r\n}\r\n// 触发依赖收集\r\nexport function trigger(target,type,key,value,oldValue){\r\n\r\n    const depsMap = targetMap.get(target)\r\n    if(!depsMap){ // 判断是否已经进行过收集依赖\r\n        return false\r\n    }\r\n    const run = effects =>{\r\n        if(effects) effects.forEach(effect=>effect())\r\n    }\r\n\r\n    // 数组有特殊的情况\r\n    if(key==='length'&&isArray(target)){\r\n        // depsMap.forEach((dep,key)=>{ // map可以循环\r\n        //     if(key==='length'||key>=value){ // 如果改的长度小于数组原有的长度,应该更新视图\r\n        //         run(dep)\r\n        //     }\r\n        // })\r\n    }else{\r\n        // 对象的处理\r\n        if(key!==undefined){ // 说明修改了key\r\n            run(depsMap.get(key))\r\n        }\r\n    }\r\n}","\r\n\r\nimport {isSymbol,isObject, hasOwn, hasChanged,isArray,isInteger} from '../shared/index'\r\nimport { reactive } from './reactive'\r\nimport {track, trigger} from './effect'\r\nfunction createGetter(){\r\n    return function get(target,key,receiver){\r\n        const res = Reflect.get(target,key,receiver)\r\n\r\n        // 如果 取得值是symbol类型 我要忽略它\r\n        if(isSymbol(key)){ // 数组中有很多symbol的内置方法\r\n            return res\r\n        }\r\n\r\n        console.log('=========',target,key)\r\n\r\n        //依赖收集\r\n        track(target,key)\r\n        if(isObject(res)){  //取值是对象进行代理\r\n            return reactive(res)\r\n        }\r\n\r\n        return res\r\n    }\r\n}\r\n\r\nfunction createSetter(){\r\n    return function set(target,key,value,receiver){\r\n\r\n\r\n        const oldValue = target[key] ; // 如果是修改那肯定有老值\r\n        // 看一下有没有这个属性\r\n\r\n\r\n        // 第一种是数组新增的逻辑 第二种是对象的逻辑\r\n        const hadKey = isArray(target)&&isInteger(key)?Number(key)<target.length:hasOwn(target,key)\r\n\r\n\r\n        const res = Reflect.set(target,key,value,receiver)\r\n\r\n        // 新增\r\n        if(!hadKey){\r\n            trigger(target,'add',key,value)\r\n        // 修改   \r\n        }else if(hasChanged(value,oldValue)){\r\n            trigger(target,'set',key,value,oldValue)\r\n        }\r\n\r\n\r\n\r\n        return res\r\n    }\r\n}\r\n\r\nconst get = createGetter()\r\nconst set = createSetter()\r\n\r\nexport const mutableHandlers = {\r\n    get, // 获取对象中的属性会执行此方法\r\n    set //设置属性值得时候会执行此方法\r\n}","import { isObject } from \"../shared/index\"\r\nimport { mutableHandlers } from \"./baseHandlers\"\r\n\r\n\r\n\r\nconst proxyMap = new WeakMap()\r\nexport function reactive(target){\r\n    // 将目标变成响应式 Proxy\r\n    return  createReactiveObject(target,mutableHandlers) // 核心操作就是当读取文件的时候做依赖收集，当数据变化时重新执行effect\r\n}\r\n\r\n\r\nfunction createReactiveObject(target,baseHandlers){\r\n    // 如果不是对象 直接返回出去\r\n    if(!isObject(target)){\r\n        return target\r\n    }\r\n    // 做缓存 看存不存在\r\n    const exisitingProxy = proxyMap.get(target)\r\n    if(exisitingProxy){\r\n        return exisitingProxy\r\n    }\r\n    // 只是对最外层对象做代理 默认不会递归 而且不会重新重写对象中的属性 \r\n    const proxy = new Proxy(target,baseHandlers)\r\n    proxyMap.set(target,proxy) // 将代理的对象和代理后的结果做一个映射表\r\n    return proxy \r\n}","export function ref(target){\r\n\r\n}"],"names":["computed","isObject","val","isSymbol","isArray","Array","isInteger","key","parseInt","hasOwnProperty","Object","prototype","hasOwn","call","hasChanged","value","oldValue","effect","fn","options","createReactiveEffect","lazy","uid","activeEffect","effectStack","includes","push","pop","length","id","deps","targetMap","WeakMap","track","target","undefined","depsMap","get","set","Map","dep","Set","has","add","trigger","type","run","effects","forEach","createGetter","receiver","res","Reflect","console","log","reactive","createSetter","hadKey","Number","mutableHandlers","proxyMap","createReactiveObject","baseHandlers","exisitingProxy","proxy","Proxy","ref"],"mappings":"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"}